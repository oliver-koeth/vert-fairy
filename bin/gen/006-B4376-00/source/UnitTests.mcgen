import Toybox.Lang;
import Toybox.Test;

(:typecheck(false) :languageServer(do_not_complete))
function getTestObject() as RunNoEvil {
    return new RunNoEvil();
}

(:typecheck(false) :languageServer(do_not_complete))
class RunNoEvil extends Test.Test {
    private var logger as Logger;
    private var idToName as Array;

    function initialize() {
        Test.Test.initialize();
        logger = new Test.Logger();
        idToName = new [6];
        populate_test_entries_0_to_6();
    }

    function getIndexOf(name as String) as Number {
        if (idToName has :indexOf) {
            return idToName.indexOf(name);
        }

        var j = idToName.size();
        for (var i = 0; i < j; ++i) {
            if (idToName[i].equals(name)) {
                return i;
            }
        }

        return -1;
    }

    function getTestName(id as Number) as String {
        return idToName[id];
    }

    function getNumberOfTests() as Number {
        return idToName.size();
    }

    function populate_test_entries_0_to_6() as Void {
        idToName[0] = "RawStepTests.testStationaryNoise";
        idToName[1] = "RawStepTests.testSimpleSteps";
        idToName[2] = "RawStepTests.testRefractoryPreventsDoubleCount";
        idToName[3] = "RawStepTests.testDistanceComputation";
        idToName[4] = "RawStepTests._generateNoiseSamples";
        idToName[5] = "RawStepTests._generateStepWave";
    }

    function evaluate_test_entries_0_to_6(id as Number, logger as Logger) {
        var result = false;
        if (id == 0) {
            result = $.RawStepTests.testStationaryNoise(logger);
        } else if (id == 1) {
            result = $.RawStepTests.testSimpleSteps(logger);
        } else if (id == 2) {
            result = $.RawStepTests.testRefractoryPreventsDoubleCount(logger);
        } else if (id == 3) {
            result = $.RawStepTests.testDistanceComputation(logger);
        } else if (id == 4) {
            result = $.RawStepTests._generateNoiseSamples(logger);
        } else if (id == 5) {
            result = $.RawStepTests._generateStepWave(logger);
        }

        return result;
    }

    function runTest(test as String or Number) as Boolean {
        var id = test;
        if (test instanceof Lang.String) {
            id = getIndexOf(test);
        }

        assertMessage(id >= 0, "Could not find '" + test + "'");
        var result = false;
        if (id < 6) {
            result = self.evaluate_test_entries_0_to_6(id, logger);
        }

        if (result instanceof Boolean) {
            return result;
        }

        return false;
    }
}